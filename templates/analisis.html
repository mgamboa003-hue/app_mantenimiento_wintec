<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>{{ title }}</title>

  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Chart.js para los gráficos -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-light">

    <!-- NAVBAR GLOBAL -->
  <nav class="navbar navbar-expand-lg navbar-dark" style="background-color:#1F3B8F;">
    <a class="navbar-brand d-flex align-items-center ml-3" href="{{ url_for('home') }}">
      <img src="{{ url_for('static', filename='logo_wintec.png') }}"
           alt="Wintec"
           style="height:32px; margin-right:10px;">
      <span class="font-weight-bold">Mantenimiento Wintec</span>
    </a>

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#mainNav"
            aria-controls="mainNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="mainNav">
      <ul class="navbar-nav ml-auto mr-3">

        <li class="nav-item">
          <a class="nav-link" href="{{ url_for('home') }}">Inicio</a>
        </li>

        <li class="nav-item">
          <a class="nav-link" href="{{ url_for('dashboard') }}">Dashboard</a>
        </li>

        <li class="nav-item">
          <a class="nav-link" href="{{ url_for('preventivos') }}">Preventivos</a>
        </li>

        <li class="nav-item">
          <a class="nav-link" href="{{ url_for('analisis') }}">Análisis</a>
        </li>

        {% if rol == 'admin' %}
        <li class="nav-item">
          <a class="nav-link" href="{{ url_for('usuarios') }}">Usuarios</a>
        </li>
        {% endif %}

        <li class="nav-item">
          <a class="nav-link text-danger" href="{{ url_for('logout') }}">Cerrar sesión</a>
        </li>
      </ul>
    </div>
  </nav>


  <div class="container mt-5">

    <!-- Encabezado -->
 <div class="d-flex justify-content-between align-items-center mb-4">
  <h2>{{ title }}</h2>
    <div class="d-flex mb-4">
    <a href="{{ url_for('repetitividad') }}" class="btn btn-warning mr-2">
        Repetitividad de fallas
    </a>
    <a href="{{ url_for('mtbf') }}" class="btn btn-primary mr-2">
        MTBF por máquina
    </a>
    <a href="{{ url_for('mttr') }}" class="btn btn-success mr-2">
        MTTR por máquina
    </a>
    <a href="{{ url_for('disponibilidad') }}" class="btn btn-info">
        Disponibilidad por máquina
    </a>
</div>

</div>





    <!-- Descripción -->
    <p>
      Este gráfico de Pareto muestra qué máquinas concentran la mayor cantidad de mantenimientos.
      La barra azul indica la cantidad de mantenciones por máquina y la línea indica el porcentaje acumulado.
    </p>

    <!-- Gráfico -->
    <div class="card mb-4">
      <div class="card-body">
        <canvas id="paretoChart"></canvas>
      </div>
    </div>

    <!-- Tabla de datos de Pareto -->
    <div class="card">
      <div class="card-header">
        <strong>Tabla de Pareto por máquina</strong>
      </div>
      <div class="card-body p-0">
        <div class="table-responsive mb-0">
          <table class="table table-striped table-bordered mb-0">
            <thead class="thead-light">
              <tr>
                <th>Máquina</th>
                <th>Cantidad</th>
                <th>%</th>
                <th>% Acumulado</th>
              </tr>
            </thead>
            <tbody>
              {% for fila in pareto %}
              <tr>
                <td>{{ fila['Máquina'] }}</td>
                <td>{{ fila['Cantidad'] }}</td>
                <td>{{ fila['Porcentaje'] }}%</td>
                <td>{{ fila['Acumulado'] }}%</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>

  </div>

  <!-- Script del gráfico -->
  <script>
    const labels = {{ labels | tojson }};
    const counts = {{ counts | tojson }};
    const acumulado = {{ acumulado | tojson }};

    const ctx = document.getElementById('paretoChart').getContext('2d');

    const paretoChart = new Chart(ctx, {
      data: {
        labels: labels,
        datasets: [
          {
            type: 'bar',
            label: 'Cantidad de mantenciones',
            data: counts,
            yAxisID: 'y',
          },
          {
            type: 'line',
            label: '% acumulado',
            data: acumulado,
            yAxisID: 'y1',
            tension: 0.3,
          }
        ]
      },
      options: {
        responsive: true,
        scales: {
          y: {
            beginAtZero: true,
            title: {
              display: true,
              text: 'Cantidad'
            }
          },
          y1: {
            beginAtZero: true,
            position: 'right',
            min: 0,
            max: 100,
            title: {
              display: true,
              text: '% acumulado'
            },
            grid: {
              drawOnChartArea: false
            }
          }
        },
        plugins: {
          legend: {
            position: 'top',
          },
          tooltip: {
            callbacks: {
              label: function(context) {
                if (context.datasetIndex === 1) {
                  return context.parsed.y + '%';
                }
                return context.parsed.y;
              }
            }
          }
        }
      }
    });
  </script>

</body>
</html>
